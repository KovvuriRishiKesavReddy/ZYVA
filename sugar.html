<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZYVA - Blood Sugar Analysis</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #E3F2FD 0%, #BBDEFB 50%, #90CAF9 100%);
            min-height: 100vh;
            background-attachment: fixed;
        }
        footer {
            margin-top: auto;
            background: linear-gradient(135deg, #0369A1 0%, #0EA5E9 100%);
            color: white;
        }
        .card-gradient {
            background: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.7) 100%);
        }
        .result-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(255,255,255,0.85) 100%);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(66, 165, 245, 0.3);
        }
        .normal { border-left: 6px solid #10B981; }
        .prediabetic { border-left: 6px solid #F59E0B; }
        .diabetic { border-left: 6px solid #EF4444; }
        .nav-link.active {
            background: linear-gradient(to right, rgba(30, 136, 229, 0.1), rgba(66, 165, 245, 0.2));
            border-bottom: 3px solid #1976D2;
            font-weight: 600;
        }
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .gradient-text {
            background: linear-gradient(135deg, #1976D2 0%, #42A5F5 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="fixed top-0 left-0 w-full z-50 bg-white bg-opacity-90 shadow-md">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center">
                    <img src="logo.jpg" alt="ZYVA Logo" class="h-8 w-auto">
                    <span class="ml-2 text-xl font-semibold text-gray-800">ZYVA</span>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="home_page.html" class="px-3 py-2 text-sm font-medium text-gray-800 hover:text-yellow-700">Home</a>
                    <a href="medicine.html" class="px-3 py-2 text-sm font-medium text-gray-800 hover:text-yellow-700">Medicines</a>
                    <a href="doctor.html" class="px-3 py-2 text-sm font-medium text-gray-800 hover:text-yellow-700">Doctors</a>
                    <a href="scans.html" class="px-3 py-2 text-sm font-medium text-gray-800 hover:text-yellow-700">Scans</a>
                    <a href="orders.html" class="px-3 py-2 text-sm font-medium text-gray-800 hover:text-yellow-700">Orders</a>
                    <a href="appointments.html" class="px-3 py-2 text-sm font-medium text-gray-800 hover:text-yellow-700">Appointments</a>
                    <a href="reminder.html" class="px-3 py-2 text-sm font-medium text-gray-800 hover:text-yellow-700">Reminders</a>
                    <div class="relative group">
                        <a href="#" class="nav-link active px-3 py-2 rounded-md text-sm font-medium text-gray-800">My Health</a>
                        <div class="hidden absolute right-0 mt-2 bg-white rounded-lg shadow-xl border border-gray-200 w-56 z-50 group-hover:block">
                            <a href="prescriptions.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50">Prescriptions</a>
                            <a href="symptom_checker.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50">Symptom Checker</a>
                            <a href="blood_analysis.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50">Blood Analysis</a>
                            <a href="sugar.html" class="block px-4 py-2 text-sm text-blue-600 bg-blue-50">Blood Sugar Analysis</a>
                        </div>
                    </div>
                    <a href="insurance.html" class="px-3 py-2 text-sm font-medium text-gray-800 hover:text-yellow-700">Insurance</a>
                    <div class="relative">
                        <div id="userMenuButton" class="w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center text-xs font-semibold cursor-pointer select-none" style="display: none;"></div>
                        <div id="userMenu" class="hidden absolute right-0 mt-2 bg-white rounded-lg shadow-xl border border-gray-200 w-56 z-50">
                            <div class="px-4 py-3 border-b border-gray-100">
                                <div id="menuName" class="text-sm font-semibold text-gray-800">Guest</div>
                                <div id="menuEmail" class="text-xs text-gray-500 truncate">guest@example.com</div>
                            </div>
                            <div class="py-1">
                                <a href="profile.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50">Profile</a>
                                <a href="my_insurance.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50">My Insurance</a>
                                <button id="logout-btn" class="w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50">Log out</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8 pt-24">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold gradient-text mb-4">Blood Sugar Analysis</h1>
            <p class="text-lg text-gray-600">Monitor your glucose levels and get personalized health recommendations</p>
        </div>

        <!-- Input Form -->
        <div class="card-gradient rounded-xl shadow-xl p-8 mb-8">
            <h2 class="text-2xl font-semibold text-gray-800 mb-6 flex items-center">
                <svg class="w-6 h-6 mr-2 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                </svg>
                Enter Your Information
            </h2>
            
            <form id="sugar-form" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div class="space-y-2">
                    <label class="text-sm font-medium text-gray-700">Age</label>
                    <input type="number" id="age" min="1" max="120" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Enter your age" required>
                </div>
                
                <div class="space-y-2">
                    <label class="text-sm font-medium text-gray-700">Gender</label>
                    <select id="gender" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                        <option value="">Select gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                    </select>
                </div>
                
                <div class="space-y-2">
                    <label class="text-sm font-medium text-gray-700">Weight (kg)</label>
                    <input type="number" id="weight" min="20" max="300" step="0.1" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Enter weight" required>
                </div>
                
                <div class="space-y-2">
                    <label class="text-sm font-medium text-gray-700">Height (cm)</label>
                    <input type="number" id="height" min="100" max="250" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Enter height" required>
                </div>
                
                <div class="space-y-2">
                    <label class="text-sm font-medium text-gray-700">Test Type</label>
                    <select id="test-type" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                        <option value="">Select test type</option>
                        <option value="fasting">Fasting Blood Sugar (FBS)</option>
                        <option value="random">Random Blood Sugar (RBS)</option>
                        <option value="hba1c">HbA1c</option>
                        <option value="ogtt">Oral Glucose Tolerance Test (OGTT)</option>
                    </select>
                </div>
                
                <div class="space-y-2">
                    <label class="text-sm font-medium text-gray-700" id="glucose-label">Glucose Level</label>
                    <div class="relative">
                        <input type="number" id="glucose-level" min="0" step="0.1" class="w-full px-4 py-3 pr-16 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Enter value" required>
                        <span id="glucose-unit" class="absolute right-3 top-3 text-sm text-gray-500">mg/dL</span>
                    </div>
                </div>
                
                <div class="space-y-2 md:col-span-2 lg:col-span-3">
                    <label class="text-sm font-medium text-gray-700">Additional Risk Factors (Optional)</label>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-2">
                        <label class="flex items-center space-x-2">
                            <input type="checkbox" id="family-history" class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                            <span class="text-sm text-gray-700">Family history of diabetes</span>
                        </label>
                        <label class="flex items-center space-x-2">
                            <input type="checkbox" id="high-bp" class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                            <span class="text-sm text-gray-700">High blood pressure</span>
                        </label>
                        <label class="flex items-center space-x-2">
                            <input type="checkbox" id="sedentary" class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                            <span class="text-sm text-gray-700">Sedentary lifestyle</span>
                        </label>
                    </div>
                </div>
                
                <div class="md:col-span-2 lg:col-span-3">
                    <button type="submit" class="w-full bg-gradient-to-r from-blue-600 to-blue-700 text-white py-4 px-8 rounded-lg font-semibold text-lg hover:from-blue-700 hover:to-blue-800 transform transition duration-200 hover:scale-105 shadow-lg">
                        <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                        Analyze Blood Sugar
                    </button>
                </div>
            </form>
        </div>

        <!-- Results Section -->
        <div id="results-section" class="hidden fade-in">
            <!-- Analysis Result Card -->
            <div id="result-card" class="result-card rounded-xl shadow-xl p-8 mb-8">
                <div class="text-center mb-6">
                    <div id="result-icon" class="mx-auto w-16 h-16 rounded-full flex items-center justify-center mb-4">
                        <!-- Icon will be added by JS -->
                    </div>
                    <h2 id="result-title" class="text-3xl font-bold mb-2"></h2>
                    <p id="result-description" class="text-lg text-gray-600"></p>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div class="bg-white bg-opacity-50 rounded-lg p-4 text-center">
                        <h3 class="font-semibold text-gray-700 mb-2">Your Level</h3>
                        <p id="your-level" class="text-2xl font-bold text-blue-600"></p>
                    </div>
                    <div class="bg-white bg-opacity-50 rounded-lg p-4 text-center">
                        <h3 class="font-semibold text-gray-700 mb-2">BMI</h3>
                        <p id="bmi-value" class="text-2xl font-bold text-blue-600"></p>
                    </div>
                    <div class="bg-white bg-opacity-50 rounded-lg p-4 text-center">
                        <h3 class="font-semibold text-gray-700 mb-2">Risk Level</h3>
                        <p id="risk-level" class="text-2xl font-bold"></p>
                    </div>
                </div>
                
                <div id="detailed-info" class="bg-white bg-opacity-50 rounded-lg p-4">
                    <!-- Detailed information will be added by JS -->
                </div>
            </div>

            <!-- Recommendations Section -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Diet Recommendations -->
                <div id="diet-recommendations" class="result-card rounded-xl shadow-xl p-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                        <svg class="w-6 h-6 mr-2 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3"></path>
                        </svg>
                        Diet Recommendations
                    </h3>
                    <div id="diet-content">
                        <!-- Diet recommendations will be added by JS -->
                    </div>
                </div>

                <!-- Exercise Recommendations -->
                <div id="exercise-recommendations" class="result-card rounded-xl shadow-xl p-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                        <svg class="w-6 h-6 mr-2 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                        </svg>
                        Exercise Recommendations
                    </h3>
                    <div id="exercise-content">
                        <!-- Exercise recommendations will be added by JS -->
                    </div>
                </div>
            </div>

            <!-- Additional Resources -->
            <div class="result-card rounded-xl shadow-xl p-6 mt-8">
                <h3 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    Additional Recommendations
                </h3>
                <div id="additional-content" class="space-y-3">
                    <!-- Additional recommendations will be added by JS -->
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex flex-col md:flex-row gap-4 mt-8">
                <button onclick="window.print()" class="flex-1 bg-gradient-to-r from-gray-600 to-gray-700 text-white py-3 px-6 rounded-lg font-semibold hover:from-gray-700 hover:to-gray-800 transform transition duration-200 hover:scale-105">
                    <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path>
                    </svg>
                    Print Results
                </button>
                <a href="doctor.html" class="flex-1 bg-gradient-to-r from-blue-600 to-blue-700 text-white py-3 px-6 rounded-lg font-semibold text-center hover:from-blue-700 hover:to-blue-800 transform transition duration-200 hover:scale-105">
                    <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                    Consult a Doctor
                </a>
                <button id="save-results" class="flex-1 bg-gradient-to-r from-green-600 to-green-700 text-white py-3 px-6 rounded-lg font-semibold hover:from-green-700 hover:to-green-800 transform transition duration-200 hover:scale-105">
                    <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path>
                    </svg>
                    Save to Profile
                </button>
            </div>
        </div>
    </div>

    <footer class="py-6 flex-grow bottom-0 left-0 w-full">
        <div class="text-center text-sm">© 2025 ZYVA Healthcare. All rights reserved to ZYVA.</div>
    </footer>

    <script src="auth.js"></script>
    <script src="sugar.js"></script>
    <script>
    // Backup prefill function in case external script doesn't load
    document.addEventListener('DOMContentLoaded', function() {
        setTimeout(function() {
            try {
                console.log('=== INLINE PREFILL DEBUG ===');
                
                // Get user data
                const userDataString = localStorage.getItem('currentUser') || sessionStorage.getItem('currentUser');
                console.log('User data string:', userDataString);
                
                if (!userDataString) {
                    console.log('No user data found');
                    return;
                }
                
                const userData = JSON.parse(userDataString);
                console.log('Parsed user data:', userData);
                console.log('Available fields:', Object.keys(userData));
                
                // Check form fields
                const ageField = document.getElementById('age');
                const genderField = document.getElementById('gender');
                console.log('Age field exists:', !!ageField);
                console.log('Gender field exists:', !!genderField);
                
                // Try to prefill age
                if (userData.dateOfBirth && ageField) {
                    const today = new Date();
                    const birthDate = new Date(userData.dateOfBirth);
                    let age = today.getFullYear() - birthDate.getFullYear();
                    const monthDiff = today.getMonth() - birthDate.getMonth();
                    if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                        age--;
                    }
                    if (age > 0 && age < 150) {
                        ageField.value = age;
                        console.log('✓ Age prefilled:', age);
                    }
                } else if (userData.age && ageField) {
                    ageField.value = userData.age;
                    console.log('✓ Age prefilled from direct value:', userData.age);
                } else {
                    console.log('✗ Could not prefill age');
                }
                
                // Try to prefill gender
                if (userData.gender && genderField) {
                    const gender = userData.gender.toLowerCase().trim();
                    if (gender === 'male' || gender === 'female') {
                        genderField.value = gender;
                        console.log('✓ Gender prefilled:', gender);
                    } else if (gender === 'm' || gender === 'man') {
                        genderField.value = 'male';
                        console.log('✓ Gender prefilled: male');
                    } else if (gender === 'f' || gender === 'woman') {
                        genderField.value = 'female';
                        console.log('✓ Gender prefilled: female');
                    }
                } else {
                    console.log('✗ Could not prefill gender');
                }
                
                console.log('=== END INLINE PREFILL DEBUG ===');
                
            } catch (error) {
                console.error('Inline prefill error:', error);
            }
        }, 500); // Wait 500ms for everything to load
    });
    </script>
</body>
</html>